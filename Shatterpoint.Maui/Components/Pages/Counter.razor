@using Shatterpoint.Maui.Services;
@using Shatterpoint.Maui.Units
@using Shatterpoint.Maui.Units.Abilities
@using Shatterpoint.Maui.Models;

@page "/counter"
@inject SelectedUnitsService SelectedUnitsService
@inject UnitDataBaseService UnitDataBaseService

<h1>Counter</h1>

<div>

    @if (!@SelectedUnitsService.SelectedUnits.Any())
    {
        <p>There is no selected unit. Visit /build/index to select your 6 units</p>
    }
    @foreach (var unit in @SelectedUnitsService.SelectedUnits)
    {
        <a href="#" @onclick="() => ActivateUnit(unit)">
            <img alt="@unit.ProfilePicture" src="@GetPpUrl(unit.ProfilePicture)" />
        </a>
    }
</div>

@if(@ActiveUnit is not null)
{
    @ActiveUnit.ActiveUnit.Name;
}

@code {

    public static ActiveUnitModel ActiveUnit { get; set; }

    public void ActivateUnit(Unit unit)
    {
        var activeAbilities = SelectedUnitsService.ActivateUnit(unit);

        var ActiveUnit = new ActiveUnitModel();
        ActiveUnit.ActiveUnit = unit;
        ActiveUnit.CurrentActivationSynergies = activeAbilities;
    }

    public string GetPpUrl(string ppName)
    {
        var ppUrl = "/img/pp/" + ppName;
        return ppUrl;
    }
}
